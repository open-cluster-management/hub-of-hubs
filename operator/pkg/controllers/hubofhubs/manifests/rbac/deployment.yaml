---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: multicluster-globalhub-rbac
  namespace: open-cluster-management
  labels:
    name: multicluster-globalhub-rbac
spec:
  replicas: 1
  selector:
    matchLabels:
      name: multicluster-globalhub-rbac
  template:
    metadata:
      labels:
        name: multicluster-globalhub-rbac
    spec:
      serviceAccountName: multicluster-globalhub-rbac
      containers:
        - name: multicluster-globalhub-rbac
          image: {{.Image}}
          imagePullPolicy: Always
          args:
          - "/data/opa_authorization.rego"
          - "/data/data.json"
          - "/data/role_bindings.yaml"
          - "--tls-cert-file=/certs/tls.crt"
          - "--tls-private-key-file=/certs/tls.key"
          - "--authorization=basic"
          volumeMounts:
           - readOnly: true
             mountPath: /data
             name: opa-data
           - readOnly: true
             mountPath: /certs
             name: certs
      volumes:
       - name: opa-data
         secret:
           secretName: opa-data
       - name: certs
         secret:
           secretName: multicluster-globalhub-rbac-certs
